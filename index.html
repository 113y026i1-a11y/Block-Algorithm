<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>積木式演算法構建工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #4a6fa5;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .panel {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        .panel-title {
            font-size: 1.3rem;
            color: #3498db;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .panel-title i {
            font-size: 1.2rem;
        }
        
        .blocks-panel {
            flex: 1;
            min-width: 250px;
        }
        
        .workspace-panel {
            flex: 2;
            min-width: 400px;
            min-height: 500px;
        }
        
        .control-panel {
            flex: 1;
            min-width: 300px;
        }
        
        .blocks-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .block-category {
            margin-bottom: 20px;
        }
        
        .category-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .block {
            padding: 12px 15px;
            border-radius: 6px;
            cursor: grab;
            margin-bottom: 8px;
            user-select: none;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            border-left: 4px solid;
        }
        
        .block:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .block:active {
            cursor: grabbing;
        }
        
        .block-control {
            border-left-color: #e74c3c;
            background-color: #ffeaea;
        }
        
        .block-data {
            border-left-color: #3498db;
            background-color: #eaf2f8;
        }
        
        .block-io {
            border-left-color: #2ecc71;
            background-color: #eafaf1;
        }
        
        .block-logic {
            border-left-color: #9b59b6;
            background-color: #f4ecf7;
        }
        
        .block-text {
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .block-param {
            background-color: white;
            padding: 2px 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            min-width: 40px;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .workspace {
            min-height: 450px;
            border: 2px dashed #bdc3c7;
            border-radius: 8px;
            padding: 15px;
            background-color: #f9f9f9;
            position: relative;
        }
        
        .workspace-placeholder {
            color: #95a5a6;
            text-align: center;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.1rem;
        }
        
        .algorithm-container {
            min-height: 100%;
        }
        
        .algorithm-block {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            position: relative;
            border-left: 4px solid;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .block-actions {
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .algorithm-block:hover .block-actions {
            opacity: 1;
        }
        
        .block-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }
        
        .block-delete {
            background-color: #e74c3c;
            color: white;
        }
        
        .block-delete:hover {
            background-color: #c0392b;
        }
        
        .block-edit {
            background-color: #3498db;
            color: white;
        }
        
        .block-edit:hover {
            background-color: #2980b9;
        }
        
        .file-upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 25px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .file-upload-area:hover {
            background-color: #eaf2f8;
        }
        
        .file-upload-area i {
            font-size: 2.5rem;
            color: #3498db;
            margin-bottom: 10px;
        }
        
        .file-info {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .console {
            background-color: #2c3e50;
            color: #ecf0f1;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            height: 200px;
            overflow-y: auto;
        }
        
        .console-title {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #bdc3c7;
        }
        
        .console-content {
            white-space: pre-wrap;
            line-height: 1.4;
            font-size: 0.95rem;
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
            transition: background-color 0.2s, transform 0.1s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-run {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-run:hover {
            background-color: #27ae60;
        }
        
        .btn-clear {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-clear:hover {
            background-color: #c0392b;
        }
        
        .btn-reset {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-reset:hover {
            background-color: #d35400;
        }
        
        .param-input {
            width: 60px;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            text-align: center;
            background-color: white;
        }
        
        .dropdown {
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            background-color: white;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .hidden {
            display: none;
        }
        
        .success {
            color: #2ecc71;
        }
        
        .error {
            color: #e74c3c;
        }
        
        .log-entry {
            margin-bottom: 5px;
        }
        
        @media (max-width: 1100px) {
            .container {
                flex-direction: column;
            }
            
            .panel {
                width: 100%;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-cubes"></i> 積木式演算法構建工具</h1>
        <p class="subtitle">拖放積木構建演算法，讀取並處理文件內容</p>
    </div>
    
    <div class="container">
        <!-- 左側：積木庫 -->
        <div class="panel blocks-panel">
            <div class="panel-title">
                <i class="fas fa-th-large"></i> 積木庫
            </div>
            
            <div class="blocks-container">
                <div class="block-category">
                    <div class="category-title">控制結構</div>
                    <div class="block block-control" data-type="loop" data-params="count">
                        <div class="block-text">
                            <i class="fas fa-redo"></i> 重複 
                            <input type="number" class="param-input" value="3" min="1" max="20"> 
                            次
                        </div>
                    </div>
                    <div class="block block-control" data-type="while" data-params="condition">
                        <div class="block-text">
                            <i class="fas fa-sync-alt"></i> 當條件 
                            <select class="dropdown param-condition">
                                <option value="true">為真</option>
                                <option value="hasContent">文件有內容</option>
                                <option value="lineCount<10">行數少於10</option>
                            </select>
                            時執行
                        </div>
                    </div>
                </div>
                
                <div class="block-category">
                    <div class="category-title">數據操作</div>
                    <div class="block block-data" data-type="variable" data-params="name,value">
                        <div class="block-text">
                            <i class="fas fa-tag"></i> 設定變數 
                            <input type="text" class="param-input" value="x" style="width: 50px;"> 
                            為 
                            <input type="text" class="param-input" value="0" style="width: 50px;">
                        </div>
                    </div>
                    <div class="block block-data" data-type="increment" data-params="name">
                        <div class="block-text">
                            <i class="fas fa-plus-circle"></i> 增加變數 
                            <input type="text" class="param-input" value="x" style="width: 50px;"> 
                            的值
                        </div>
                    </div>
                </div>
                
                <div class="block-category">
                    <div class="category-title">輸入/輸出</div>
                    <div class="block block-io" data-type="readFile">
                        <div class="block-text">
                            <i class="fas fa-file-upload"></i> 讀取上傳的文件
                        </div>
                    </div>
                    <div class="block block-io" data-type="print" data-params="text">
                        <div class="block-text">
                            <i class="fas fa-print"></i> 輸出 
                            <input type="text" class="param-input" value="結果" style="width: 80px;">
                        </div>
                    </div>
                    <div class="block block-io" data-type="printVar" data-params="name">
                        <div class="block-text">
                            <i class="fas fa-terminal"></i> 輸出變數 
                            <input type="text" class="param-input" value="x" style="width: 50px;">
                        </div>
                    </div>
                </div>
                
                <div class="block-category">
                    <div class="category-title">邏輯操作</div>
                    <div class="block block-logic" data-type="if" data-params="condition">
                        <div class="block-text">
                            <i class="fas fa-question-circle"></i> 如果 
                            <select class="dropdown param-condition">
                                <option value="true">條件為真</option>
                                <option value="hasLines">文件有行</option>
                                <option value="var>5">變數大於5</option>
                            </select>
                        </div>
                    </div>
                    <div class="block block-logic" data-type="compare" data-params="var1,operator,var2">
                        <div class="block-text">
                            <i class="fas fa-balance-scale"></i> 比較 
                            <input type="text" class="param-input" value="x" style="width: 40px;">
                            <select class="dropdown">
                                <option value=">">大於</option>
                                <option value="<">小於</option>
                                <option value="=="">等於</option>
                            </select>
                            <input type="text" class="param-input" value="5" style="width: 40px;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 中間：工作區 -->
        <div class="panel workspace-panel">
            <div class="panel-title">
                <i class="fas fa-code"></i> 演算法工作區
            </div>
            
            <div class="workspace" id="workspace">
                <div class="workspace-placeholder" id="workspacePlaceholder">
                    <i class="fas fa-hand-point-left"></i><br>
                    從左側拖動積木到此處開始構建演算法
                </div>
                <div class="algorithm-container" id="algorithmContainer"></div>
            </div>
        </div>
        
        <!-- 右側：控制面板 -->
        <div class="panel control-panel">
            <div class="panel-title">
                <i class="fas fa-file-import"></i> 文件上傳與執行
            </div>
            
            <div class="file-upload-area" id="fileUploadArea">
                <i class="fas fa-cloud-upload-alt"></i>
                <div>點擊或拖放文件到此處上傳</div>
                <div class="file-info">支持 .txt, .csv, .json 文件</div>
                <input type="file" id="fileInput" class="hidden" accept=".txt,.csv,.json,.xml">
            </div>
            
            <div id="fileDetails" class="hidden">
                <div class="panel-title">
                    <i class="fas fa-file"></i> 文件內容預覽
                </div>
                <div id="filePreview" class="console" style="height: 150px; margin-top: 0;"></div>
            </div>
            
            <div class="control-buttons">
                <button class="btn btn-run" id="runAlgorithm">
                    <i class="fas fa-play"></i> 執行演算法
                </button>
                <button class="btn btn-clear" id="clearWorkspace">
                    <i class="fas fa-trash"></i> 清空工作區
                </button>
                <button class="btn btn-reset" id="resetAll">
                    <i class="fas fa-undo"></i> 全部重置
                </button>
            </div>
            
            <div class="panel-title" style="margin-top: 25px;">
                <i class="fas fa-terminal"></i> 執行結果
            </div>
            <div class="console">
                <div class="console-title">
                    <span>輸出控制台</span>
                    <button id="clearConsole" style="background: none; border: none; color: #bdc3c7; cursor: pointer;">
                        <i class="fas fa-trash-alt"></i> 清空
                    </button>
                </div>
                <div class="console-content" id="consoleOutput">就緒。請上傳文件並構建演算法。</div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>積木式演算法構建工具 &copy; 2023 | 拖放積木構建演算法，讀取並處理文件內容</p>
    </div>

    <script>
        // 全局變量
        let uploadedFileContent = '';
        let uploadedFileName = '';
        let variables = {};
        let blockCount = 0;
        
        // 初始化事件監聽
        document.addEventListener('DOMContentLoaded', function() {
            // 文件上傳區域事件
            const fileUploadArea = document.getElementById('fileUploadArea');
            const fileInput = document.getElementById('fileInput');
            
            fileUploadArea.addEventListener('click', () => fileInput.click());
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.style.backgroundColor = '#e1f0ff';
            });
            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.style.backgroundColor = '';
            });
            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.style.backgroundColor = '';
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileUpload(e.dataTransfer.files[0]);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length) {
                    handleFileUpload(e.target.files[0]);
                }
            });
            
            // 積木拖放功能
            setupBlockDragAndDrop();
            
            // 按鈕事件
            document.getElementById('runAlgorithm').addEventListener('click', executeAlgorithm);
            document.getElementById('clearWorkspace').addEventListener('click', clearWorkspace);
            document.getElementById('resetAll').addEventListener('click', resetAll);
            document.getElementById('clearConsole').addEventListener('click', clearConsole);
        });
        
        // 處理文件上傳
        function handleFileUpload(file) {
            if (!file.type.match('text.*') && 
                !file.name.endsWith('.txt') && 
                !file.name.endsWith('.csv') && 
                !file.name.endsWith('.json')) {
                logToConsole('錯誤：請上傳文本文件 (.txt, .csv, .json)', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedFileContent = e.target.result;
                uploadedFileName = file.name;
                
                // 更新UI
                document.getElementById('fileUploadArea').innerHTML = `
                    <i class="fas fa-file-check" style="color: #2ecc71;"></i>
                    <div>文件已上傳：${file.name}</div>
                    <div class="file-info">大小：${formatFileSize(file.size)}</div>
                    <button id="changeFile" style="margin-top: 10px; padding: 5px 10px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        更換文件
                    </button>
                `;
                
                // 添加更換文件按鈕事件
                document.getElementById('changeFile').addEventListener('click', () => {
                    fileInput.click();
                });
                
                // 顯示文件預覽
                document.getElementById('fileDetails').classList.remove('hidden');
                const preview = document.getElementById('filePreview');
                const content = uploadedFileContent.length > 500 ? 
                    uploadedFileContent.substring(0, 500) + '...' : uploadedFileContent;
                preview.textContent = content;
                
                logToConsole(`已上傳文件: ${file.name} (${formatFileSize(file.size)})`, 'success');
            };
            
            reader.onerror = function() {
                logToConsole('讀取文件時發生錯誤', 'error');
            };
            
            reader.readAsText(file);
        }
        
        // 設置積木拖放功能
        function setupBlockDragAndDrop() {
            const blocks = document.querySelectorAll('.block');
            const workspace = document.getElementById('workspace');
            const algorithmContainer = document.getElementById('algorithmContainer');
            const workspacePlaceholder = document.getElementById('workspacePlaceholder');
            
            blocks.forEach(block => {
                block.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', block.outerHTML);
                    e.dataTransfer.setData('block-type', block.dataset.type);
                    block.style.opacity = '0.4';
                });
                
                block.addEventListener('dragend', () => {
                    block.style.opacity = '1';
                });
            });
            
            workspace.addEventListener('dragover', (e) => {
                e.preventDefault();
                workspace.style.borderColor = '#3498db';
                workspace.style.backgroundColor = '#f0f7ff';
            });
            
            workspace.addEventListener('dragleave', () => {
                workspace.style.borderColor = '#bdc3c7';
                workspace.style.backgroundColor = '#f9f9f9';
            });
            
            workspace.addEventListener('drop', (e) => {
                e.preventDefault();
                workspace.style.borderColor = '#bdc3c7';
                workspace.style.backgroundColor = '#f9f9f9';
                
                // 隱藏佔位符
                workspacePlaceholder.style.display = 'none';
                
                // 創建新積木實例
                const blockHTML = e.dataTransfer.getData('text/plain');
                const blockType = e.dataTransfer.getData('block-type');
                
                if (blockHTML && blockType) {
                    const newBlock = createAlgorithmBlock(blockHTML, blockType);
                    algorithmContainer.appendChild(newBlock);
                    blockCount++;
                }
            });
        }
        
        // 創建演算法積木實例
        function createAlgorithmBlock(blockHTML, blockType) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = blockHTML;
            const blockElement = tempDiv.firstElementChild;
            
            // 轉換為演算法積木
            blockElement.classList.remove('block');
            blockElement.classList.add('algorithm-block');
            blockElement.dataset.id = 'block-' + Date.now();
            blockElement.draggable = false;
            
            // 添加操作按鈕
            const blockActions = document.createElement('div');
            blockActions.className = 'block-actions';
            blockActions.innerHTML = `
                <button class="block-btn block-edit" title="編輯參數">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="block-btn block-delete" title="刪除積木">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            
            blockElement.appendChild(blockActions);
            
            // 添加事件監聽
            blockActions.querySelector('.block-delete').addEventListener('click', function() {
                blockElement.remove();
                if (document.getElementById('algorithmContainer').children.length === 0) {
                    document.getElementById('workspacePlaceholder').style.display = 'block';
                }
            });
            
            // 讓積木內的輸入框可編輯
            const inputs = blockElement.querySelectorAll('.param-input, .dropdown');
            inputs.forEach(input => {
                input.addEventListener('click', (e) => e.stopPropagation());
                input.addEventListener('change', updateBlockParameters);
            });
            
            return blockElement;
        }
        
        // 更新積木參數
        function updateBlockParameters() {
            // 這裡可以保存參數狀態
            console.log('積木參數已更新');
        }
        
        // 執行演算法
        function executeAlgorithm() {
            if (!uploadedFileContent) {
                logToConsole('錯誤：請先上傳文件', 'error');
                return;
            }
            
            const algorithmBlocks = document.querySelectorAll('.algorithm-block');
            if (algorithmBlocks.length === 0) {
                logToConsole('錯誤：工作區中沒有積木', 'error');
                return;
            }
            
            // 重置變數
            variables = {};
            variables.lineCount = uploadedFileContent.split('\n').length;
            variables.fileContent = uploadedFileContent;
            variables.fileLines = uploadedFileContent.split('\n');
            variables.currentLine = 0;
            
            logToConsole('開始執行演算法...', 'success');
            logToConsole(`文件內容行數: ${variables.lineCount}`, 'info');
            
            // 執行每個積木
            let output = '';
            for (let block of algorithmBlocks) {
                const blockType = block.dataset.type;
                output += executeBlock(block, blockType);
            }
            
            if (output) {
                logToConsole('演算法輸出: ' + output, 'info');
            }
            
            logToConsole('演算法執行完成!', 'success');
            
            // 顯示變數狀態
            logToConsole('變數狀態:', 'info');
            for (let varName in variables) {
                if (!['fileContent', 'fileLines', 'lineCount', 'currentLine'].includes(varName)) {
                    logToConsole(`  ${varName} = ${variables[varName]}`, 'info');
                }
            }
        }
        
        // 執行單個積木
        function executeBlock(block, type) {
            let output = '';
            
            switch(type) {
                case 'loop':
                    const loopCount = parseInt(block.querySelector('.param-input').value) || 3;
                    logToConsole(`執行循環 ${loopCount} 次`, 'info');
                    for (let i = 0; i < loopCount; i++) {
                        logToConsole(`  第 ${i+1} 次循環`, 'info');
                    }
                    break;
                    
                case 'while':
                    const condition = block.querySelector('.param-condition').value;
                    logToConsole(`執行條件循環: ${condition}`, 'info');
                    break;
                    
                case 'variable':
                    const varName = block.querySelectorAll('.param-input')[0].value || 'x';
                    const varValue = block.querySelectorAll('.param-input')[1].value || '0';
                    variables[varName] = varValue;
                    logToConsole(`設定變數 ${varName} = ${varValue}`, 'info');
                    break;
                    
                case 'increment':
                    const incVarName = block.querySelector('.param-input').value || 'x';
                    if (!variables[incVarName]) variables[incVarName] = 0;
                    variables[incVarName] = parseInt(variables[incVarName]) + 1;
                    logToConsole(`增加變數 ${incVarName} = ${variables[incVarName]}`, 'info');
                    break;
                    
                case 'readFile':
                    if (uploadedFileContent) {
                        const lines = uploadedFileContent.split('\n');
                        logToConsole(`讀取文件: ${uploadedFileName}, 共 ${lines.length} 行`, 'info');
                        if (lines.length > 0) {
                            logToConsole(`第一行內容: ${lines[0].substring(0, 50)}${lines[0].length > 50 ? '...' : ''}`, 'info');
                        }
                    }
                    break;
                    
                case 'print':
                    const text = block.querySelector('.param-input').value || '結果';
                    output += text + ' ';
                    break;
                    
                case 'printVar':
                    const printVarName = block.querySelector('.param-input').value || 'x';
                    const varToPrint = variables[printVarName] || '未定義';
                    output += `${printVarName}: ${varToPrint} `;
                    break;
                    
                case 'if':
                    const ifCondition = block.querySelector('.param-condition').value;
                    logToConsole(`條件判斷: ${ifCondition}`, 'info');
                    break;
                    
                case 'compare':
                    const compareVar1 = block.querySelectorAll('.param-input')[0].value || 'x';
                    const operator = block.querySelector('.dropdown').value;
                    const compareVar2 = block.querySelectorAll('.param-input')[1].value || '5';
                    
                    const val1 = variables[compareVar1] || compareVar1;
                    const val2 = variables[compareVar2] || compareVar2;
                    
                    let result = false;
                    if (operator === '>') result = parseInt(val1) > parseInt(val2);
                    if (operator === '<') result = parseInt(val1) < parseInt(val2);
                    if (operator === '==') result = val1 == val2;
                    
                    logToConsole(`比較: ${compareVar1}(${val1}) ${operator} ${compareVar2}(${val2}) = ${result}`, 'info');
                    break;
            }
            
            return output;
        }
        
        // 清空工作區
        function clearWorkspace() {
            document.getElementById('algorithmContainer').innerHTML = '';
            document.getElementById('workspacePlaceholder').style.display = 'block';
            logToConsole('工作區已清空', 'info');
        }
        
        // 全部重置
        function resetAll() {
            clearWorkspace();
            uploadedFileContent = '';
            uploadedFileName = '';
            variables = {};
            
            document.getElementById('fileUploadArea').innerHTML = `
                <i class="fas fa-cloud-upload-alt"></i>
                <div>點擊或拖放文件到此處上傳</div>
                <div class="file-info">支持 .txt, .csv, .json 文件</div>
            `;
            
            document.getElementById('fileDetails').classList.add('hidden');
            clearConsole();
            
            // 重新設置事件監聽
            document.getElementById('fileUploadArea').addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });
            
            logToConsole('系統已重置，可以重新開始', 'success');
        }
        
        // 清空控制台
        function clearConsole() {
            document.getElementById('consoleOutput').innerHTML = '就緒。請上傳文件並構建演算法。';
        }
        
        // 記錄到控制台
        function logToConsole(message, type = 'info') {
            const consoleOutput = document.getElementById('consoleOutput');
            const timestamp = new Date().toLocaleTimeString();
            let className = 'log-entry';
            
            if (type === 'error') className += ' error';
            if (type === 'success') className += ' success';
            
            consoleOutput.innerHTML = `<div class="${className}">[${timestamp}] ${message}</div>` + consoleOutput.innerHTML;
        }
        
        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>
